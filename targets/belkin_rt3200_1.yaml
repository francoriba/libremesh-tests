targets:
  main:
    features:
      - power

    resources:
      RawSerialPort:
        port: "/dev/belkin-rt3200-1"
        speed: 115200

      NetworkService:
        address: "192.168.20.182"
        username: "root"

    drivers:
      ExternalPowerDriver:
        cmd_on: "python3 /home/franco/pi/pi-hil-testing-utils/scripts/arduino_relay_control.py on 2"
        cmd_off: "python3 /home/franco/pi/pi-hil-testing-utils/scripts/arduino_relay_control.py off 2"

      SerialDriver:
        txdelay: 0.01

      ShellDriver:
        prompt: '[\r\n]+.*?root@.*?#\s*'
        login_prompt: 'Please press Enter to activate this console\.'
        username: 'root'
        await_login_timeout: 15
        login_timeout: 120
        post_login_settle_time: 5

      SSHDriver:
        connection_timeout: 30.0
        explicit_scp_mode: False

      # U-Boot driver for recovery
      UBootDriver:
        prompt: "MT7622>"
        autoboot: "Press UP/DOWN to move"
        interrupt: "0\n"
        init_commands:
          - setenv serverip 192.168.20.234
          - setenv ipaddr 192.168.20.182
          - setenv bootfile lime-mediatek-mt7622-linksys_e8450-ubi-squashfs-sysupgrade.itb
          - tftpboot 0x4007ff28
        boot_command: bootm 0x4007ff28

      SysupgradeDriver:
        keep_config: false
        force: true
        verify_boot_timeout: 120

      PhysicalDeviceStrategy:
        requires_serial_disconnect: false
        boot_wait: 30
        connection_timeout: 30
        smart_state_detection: true
        enable_uboot_recovery: true
        max_recovery_attempts: 2
        tftp_root: "/srv/tftp"

imports:
  - ../strategies/physicalstrategy.py
  - ../drivers/sysupgrade_driver.py
